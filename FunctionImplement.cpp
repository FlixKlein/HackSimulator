/*
|	HackSimulator v0.0.4
|	
|	FunctionImplement.cpp
|	
|	https://github.com/FlixKlein/HackSimulator
|	https://gitee.com/rosemarychn/HackSimulator
|	License : MIT
|	Personal Blog : https://undertopia.top
*/
#include "hacksimulator.h"
using namespace std;
#ifdef WINCLS
void cls(){
	system("cls");
}
#elif LINUXCLS
void cls(){
	system("clear");
}
#endif
	//ai帮写的split函数
vector<string> split(string_view str, char delimiter) {
	vector<string> result;
	size_t start = 0;
	size_t pos;
	while ((pos = str.find(delimiter, start)) != string_view::npos) {
		result.emplace_back(str.substr(start, pos - start));
		start = pos + 1;
	}
	result.emplace_back(str.substr(start));
	return result;
}
list<string> split_list(string_view str, char delimiter) {
	list<string> result;
	size_t start = 0;
	size_t pos;
	while ((pos = str.find(delimiter, start)) != string_view::npos) {
		result.emplace_back(str.substr(start, pos - start));
		start = pos + 1;
	}
	result.emplace_back(str.substr(start));
	return result;
}
void search_help_from(const string& n){
	static const map<string,string> messeges = {
		{"ls","ls\t显示当前目录下的所有文件和文件夹"},
		{"mkdir","mkdir [name]\t在当前目录下创建一个文件夹"},
		{"cd","cd [path]\t切换到特定目录"},
		{"del","del [path] | [name]\t在当前或特定目录删除文件或文件夹\n可带选项:\n-f | --force\t强制删除，不弹出确认提示"},
		{"pwd","pwd\t显示当前目录全称"},
		{"cat","cat [path] | [name]\t在当前或特定目录读取可读文件内容\n可带选项：\n-a | --all\t查看全部内容"},
		{"ipconfig","ipconfig\t显示当前网络信息\n可带选项：\n-p | --port\t只显示端口信息"},
		{"cp","cp [source] [target]\t将源复制到目标"},
		{"start","start\t启动一个后台会话"},
		{"exec","exec [id] [cmd]\t后台会话[id]运行命令cmd"},
		{"exit","exit\t退出命令行，运行关机程序"}
	};
	auto it = messeges.find(n);
	if(it == messeges.end()){
		cout<<"找不到指令："<<n<<endl;
		return;
	}
	cout<<it->second<<endl;
	return;
}
string get_time(){
	time_t now = time(0);
	tm *ltm = localtime(&now);
	string now_time = to_string(ltm->tm_hour) + ":" + to_string(ltm->tm_min) + ":" + to_string(ltm->tm_sec);
	return now_time;
}
void type_text(const string& str,int delay){
	for(const char c : str){
		cout<<c<<flush;
		this_thread::sleep_for(chrono::milliseconds(delay));
	}
	cout<<endl;
}
using namespace ComputerComponents;
using namespace FileSystem;
using namespace SerializeJson;
void show_the_logo(){
	type_text("----------------------------------------------------------------------------",0);
	type_text("|   #          #             #                 ####        #         #     |",0);
	type_text("|   #          #           #   #             ##            #       #       |",0);
	type_text("|   #          #          #     #          ##              #     #         |",0);
	type_text("|   #          #         #       #        ##               #   #           |",0);
	type_text("|   #  ##  ##  #        #  # # #  #       ##               # #             |",0);
	type_text("|   #          #       #           #      ##               # #             |",0);
	type_text("|   #          #      #             #      ##              #   #           |",0);
	type_text("|   #          #     #               #       ##            #     #         |",0);
	type_text("|   #          #     #               #         ####        #       ####    |",0);
	type_text("|                                                                          |",0);
	type_text("|                 S    I    M    U    L    A    T    O    R                |",0);
	type_text("|                                黑客模拟                                  |",0);
	type_text("|                 https://github.com/FlixKlein/HackSimulator               |",0);
	type_text("|                 Blog: https://www.undertopia.top                         |",0);
	type_text("|                 LISENCE: MIT                                             |",0);
	type_text("|                 Author: Rosemary                                         |",0);
	type_text("|                 some functions helped by aistudio google                 |",0);
	type_text("----------------------------------------------------------------------------",0);
	type_text("...",1000);
	return;
}
void show_the_background(){
	cls();
	const string prolouge = R"###(
	序幕：无物之重
	
	[阁楼，2024年5月。下午的光线穿过肮脏的窗户。]
	
	伯克利・菲茨杰拉德十八岁了，他不知道自己应该想要什么。
	
	大学申请表在楼下的书桌上，个人陈述栏空白如新。他的升学顾问陈老师――一个做了二十三年这份工作的疲惫女人――用一种专门留给那些成绩不错但毫无野心的学生的疲惫眼神看着他。"你很聪明，伯克利，"她说，"但聪明不够。你得想要点什么。"
	
	他不知道该如何解释，想要东西这件事对他来说就像一门从未学过的外语。
	
	阁楼是他在房子太安静的时候来的地方，而房子总是太安静。奶奶在楼下准备晚饭――可能是披萨，她亲手做的那种，芝士太多，酱汁不够，正合他的口味。爷爷在谷仓里，动作比以前慢了，关节炎把简单的任务变成了与疼痛的谈判。
	
	他母亲在沙发上，正在喝第二瓶。
	
	伯克利推开一箱圣诞装饰品，装饰球用2003年的报纸包着。这里的一切都来自"之前"――在他父亲消失之前，在他母亲开始酗酒之前，在他出生到一个已经结束的家庭之前。
	
	蓝色的旅行箱在角落里，半藏在一个旧梳妆台后面。美国航空的标签还贴着，日期是2006年。
	
	他从未见过父亲的照片。他母亲在奶奶称之为"净化"的那场仪式中销毁了所有照片――马修・菲茨杰拉德消失三天后，她把一切都扔进后院的火坑里烧掉了。照片、信件、衣服。伯克利那时六个月大，在屋里睡觉，而他的历史化作灰烬。
	
	旅行箱没锁。
	
	里面：三件褪色的扣领衬衫，一本《麦田里的守望者》，页边空白处满是批注，还有一台ThinkPad笔记本电脑，黑色外壳上布满划痕和旅行贴纸，来自伯克利从未去过的地方――布拉格、伊斯坦布尔、曼谷。
	
	他打开笔记本时手在发抖。
	
	屏幕闪烁着亮了起来。电池在十八年后仍然有电――要么有人一直在照料它，要么这机器只是太固执而不肯死去。
	
	没有密码提示。只是一个桌面，上面有三个文件夹：工作、个人、照片。
	
	还有一个邮件客户端，显示237封未读邮件。
	
	伯克利坐在满是灰尘的地板上，笔记本电脑平衡在膝盖上。这感觉像盗墓。或者考古。也许两者都是。
	
	他点击了邮件图标。
	
	邮件加载得很慢，按日期自己排列。2006年，一直回溯到2003年。关于系统架构和安全协议的工作邮件。朋友发来的私人信息，问他去了哪里，为什么不回复，是否还好。每一封都是一座小小的纪念碑，纪念一场从未被解释的消失。
	
	伯克利滚动浏览它们，寻找某些东西――什么？忏悔？告别？关于为什么一个男人会在没有一句话的情况下离开他的婴儿儿子的解释？
	
	然后屏幕变黑了。
	
	不是关机。是黑色。就像有什么东西接管了控制权。
	
	绿色文字开始滚动，老式终端风格：
	
	```
	> 检测到未授权访问
	> 启动清除协议
	> 删除中：/Documents/Project_Helix/
	> 删除中：/Documents/Personal/
	> 删除中：/Photos/
	> 清除完成
	```
	
	他按了所有的键。什么都没有反应。他只是一个旁观者，看着他的父亲第二次被抹去。
	
	十秒钟。抹去一个生命只需要十秒钟。
	
	桌面重新出现，除了操作系统的默认图标外空空如也。
	
	然后：一封新邮件通知。
	
	---
	
	**收件箱：1封新邮件**
	
	发件人：[无发件人]  
	主题：[如果你在读这个，我已经消失了]  
	日期：2024年5月14日，下午3:47
	
	今天的日期。十分钟前。
	
	伯克利的手指悬停在触摸板上。
	
	楼下，奶奶喊道："伯克利！晚饭好了！做了你最喜欢的！"
	
	透过窗户，他能看到爷爷正在关闭谷仓，动作像是一个用纸和胶带做成的人。田野在傍晚的光线中延展成金色，同样的田野，他的家族已经耕作了三代。诚实的工作。简单的工作。那种让你晚上能睡着的工作。
	
	他可以关掉笔记本。把它放回旅行箱里。假装从未找到过它。
	
	他父亲做出了消失的选择。也许伯克利可以做出让他继续消失的选择。
	
	但他的手指已经在点击了。
	
	邮件打开了。
	
	---
	
	**[邮件内容]**
	
	> 伯克利，
	>
	> 如果你在读这个，你找到了笔记本。清除协议已经运行了。我为此感到抱歉――但有些东西太危险，不能随便留着。
	>
	> 我不知道你现在多大了。系统被设定为如果有人在2008年后访问这台机器就会触发。我在2006年写这个，希望在你需要看到它之前我就会回来。希望这一切只是偏执。
	>
	> 但如果你在读这个，我已经走了。而你在寻找答案。
	>
	> 我不能告诉你所有事情。至少现在不能。不能这样。有些真相是地雷――除非你绝对必须，否则你不想踩上去。
	>
	> 我能告诉你的是：我不是个好人，伯克利。我不是英雄。我是个技术员，看到了不该看的东西，然后做出了一个选择。有人认为信息想要自由。我认为信息只是想要生存。就像其他一切一样。
	>
	> 我离开是因为留下会让你和你母亲陷入危险。我离开是因为我认为这是正确的事。我离开是因为我是个懦夫，选择了原则而不是家庭。
	>
	> 你不欠我任何东西。不欠我你的时间，不欠我你的好奇心，不欠我你的原谅。
	>
	> 但如果你想知道发生了什么――如果你需要知道――有一根线可以拉。一个代号"赛弗"的人在暗网上经营一个信息市场。告诉他你是"幽灵"的儿子。他会给你一个起点。
	>
	> 在你这样做之前，问问你自己：你真的想知道吗？有些门，一旦打开，就关不上了。有些问题会毁掉答案。
	>
	> 你现在就可以关掉这台笔记本。去上大学，或者留在农场，或者做任何你他妈想做的事。读你的书。玩你的游戏。吃奶奶的披萨。这不是妥协，伯克利。这叫做拥有生活。
	>
	> 这个世界不需要另一个在机器中追逐幽灵的人。
	>
	> 但如果你真的这样做――如果你拉那根线――记住：不要完全信任任何人。验证所有事情。而你的名字现在是通往你还不理解的东西的钥匙。
	>
	> 我很抱歉不能在那里看到你成为什么样的人。
	>
	> 但我希望你成为一个知道何时离开的人。
	>
	> ―― M.F.
	
	---
	
	**[房子，傍晚]**
	
	伯克利在阁楼里坐到光线完全消失，一遍又一遍地读那封邮件，在字与字之间的空白处寻找隐藏的意义。
	
	*我不是英雄。*
	
	*信息只是想要生存。*
	
	*你的名字现在是一把钥匙。*
	
	最终，奶奶又喊了，她的声音穿过地板传上来。他合上笔记本，夹在腋下，下楼去了。
	
	晚饭正如他预期的那样――芝士太多的披萨，蒜蓉面包，一份没人会吃的沙拉。爷爷谈论着需要修理的拖拉机。奶奶轻轻地问起他的大学计划，用那种你在询问你知道会疼的东西时的方式。他母亲缺席着，身体在场但精神在另一个时区，她的酒杯在桌上留下湿润的圆圈。
	
	这就是他的生活。这一直是他的生活。
	
	而且这很好。这是空的，但不孤独。他有他的书――菲茨杰拉德、海明威、卡佛，所有那些写关于失去了说不出名字的东西的男人们的男人们。他有他的游戏――GTA V，他可以做一个有目的的罪犯；模拟飞行，他可以去任何地方而不用到达。
	
	他有一个给他做披萨的奶奶。一个尽管身体恳求他不要但仍然在黎明起床的爷爷。一个正在缓慢溺水的母亲，慢到你几乎可以假装她只是在游泳。
	
	这就够了。这可以够了。
	
	晚饭后，他回到自己的房间。笔记本像一个问号一样坐在他的书桌上。
	
	伯克利打开它。打开浏览器。输入："如何访问暗网。"
	
	然后关闭它。
	
	再次打开。
	
	关闭。
	
	他从床头柜上拿起《了不起的盖茨比》――他已经读了四遍，每次都能看到新的东西。今晚他读最后一页：
	
	*"于是我们继续奋力向前，逆水行舟，被不断地向后推，直至回到往昔岁月。"*
	
	菲茨杰拉德写着菲茨杰拉德。一个用一生追逐一个在他开始之前就已经死了的梦想的男人。
	
	伯克利合上书。
	
	打开笔记本。
	
	这次，他没有关上它。
	
	因为他终于明白陈老师在问他什么了。她不是在问他想做什么。她是在问他想成为谁。
	
	也许这从了解他父亲曾经是谁开始。
	
	即使答案是：一个懦夫。一个幽灵。一个选择信息而不是家庭的男人。
	
	即使答案会毁掉一切。
	
	Tor浏览器用了十二分钟下载。伯克利看着进度条填满，就像看着一根导火索朝着爆炸性的东西燃烧。
	
	当它完成时，他盯着图标看了很长时间。
	
	窗外，农场一片漆黑，除了门廊的灯。美国在它之外延展――高速公路、城市、埋藏在服务器机房里的秘密。他父亲在那里的某个地方，或者他父亲的幽灵在那里，或者只是一个决定消失的男人的数据痕迹。
	
	伯克利双击了图标。
	
	暗网加载了，缓慢而迷宫般，完全不像谷歌或脸书的干净表面。这是互联网的地下室，光线照不太到的地方。
	
	他不知道自己在做什么。
	
	但他还是在做。
	
	因为这就是绝望的人所做的事――他们跟随线索，即使它们通向nowhere。他们提出问题，即使答案会疼。他们打开门，因为不知道比任何真相都更糟糕。
	
	伯克利・菲茨杰拉德，十八岁，仍然不知道他想要什么。
	
	但他知道他需要知道什么。
	
	有时候那是同一件事。
	
	---
	
	**[此刻]**
	
	屏幕上的暗网首页像一张蜘蛛网，每一个链接都通向更深的黑暗。伯克利的房间里只有笔记本屏幕的微光，窗外农场的夜晚完全寂静，除了偶尔传来的风吹过麦田的声音――那声音像海浪，像呼吸，像时间本身在流动。
	
	他想起下午在阁楼里，尘埃在光线中漂浮，像无数个微小的星球，每一个都有自己的轨道，互不相干。他父亲的旅行箱在那里躺了十八年，就像一个被遗忘的坟墓，直到他偶然发现它。
	
	也许这不是偶然。
	
	也许这就像那封邮件说的――他的名字是一把钥匙。不是因为他特别，而是因为他是唯一留下的人。
	
	伯克利输入搜索词："赛弗 信息市场 暗网"。
	
	结果零散而隐晦，像是用密码写的地图。他点开一个论坛链接，里面的人用数字和符号交流，每个帖子都像谜语。他读了一个小时，什么都没理解，但慢慢开始认出一些模式――哪些用户受尊重，哪些话题被回避，哪些问题不应该问。
	
	这是一个平行的世界，就在他一直生活的世界下面。他在GTA V里扮演过罪犯，但那些是卡通式的罪犯，做着卡通式的坏事。这里的人是真实的――他们买卖的东西是真实的――而真实的意思是危险。
	
	凌晨两点，他找到了一个叫"奥林匹斯市场"的地方。网页设计简单到几乎不存在：黑色背景，白色文字，一行口号：
	
	**"信息即权力。权力有价。"**
	
	下方是一个联系表单。必填项：你的引荐码。
	
	伯克利停住了。
	
	他父亲说要告诉"赛弗"他是"幽灵"的儿子。但这看起来不像是你能直接说话的地方。这看起来像是一个测试。
	
	他切换回那封邮件，重新读了一遍，这次更慢，更仔细。邮件的下方有一段文字，他第一次没注意到，因为字体颜色设置成了深灰色，几乎融入黑色背景：
	
	*"在你开始之前，先学会看。不是所有重要的东西都写在明处。"*
	
	伯克利皱起眉头。他查看了邮件的源代码――一串HTML和元数据。在底部，埋藏在垃圾字符中间，有一行base64编码：
	
	```
	NjQuMTgwMzM1LC0xNDcuNjM0MDI5
	UGlrZSBQbGFjZSBNYXJrZXQ=
	VW5kZXJncm91bmQgQm9va3N0b3Jl
	```
	
	他复制粘贴到在线解码器。
	
	输出：
	```
	47.6062, -122.3321
	Pike Place Market
	Underground Bookstore
	```
	
	西雅图。派克市场。地下书店。
	
	他母亲说过那是他们第一次约会的地方。他父亲在那里给她读博尔赫斯――《沙之书》，一本永远读不完的书。
	
	伯克利坐在黑暗中，听着房子的呼吸声。楼下传来他母亲翻身的声音，酒瓶碰撞的叮当声。爷爷在另一个房间轻轻打鼾。奶奶可能还在厨房，擦着不需要擦的台面，因为她从来不肯早睡。
	
	这是他的世界。这些是他的人。
	
	而他正在准备走进另一个世界，只是因为一个十八年前消失的男人留下了一个谜题。
	
	他回到奥林匹斯市场的页面，在引荐码框里输入坐标和地址：
	
	```
	47.6062, -122.3321
	Underground Bookstore, Pike Place Market
	I am Ghost's son.
	```
	
	他的手指悬停在"提交"按钮上方。
	
	窗外，风又吹过麦田，发出那种像海浪一样的声音。伯克利突然想起小时候，也许五岁或六岁，他曾经问奶奶海是什么样子。她说就像麦田，但是湿的，而且永远不会停止移动。
	
	他从未见过海。
	
	他点击了提交。
	
	页面刷新了。一行新的文字出现：
	
	**"等待验证。请在72小时内查看。"**
	
	然后页面消失了，回到浏览器的起始页，就好像那个网站从来没有存在过。
	
	伯克利关掉笔记本，躺在床上。天花板上有一道裂缝，从角落一直延伸到吊灯，他看着那道裂缝已经看了十八年了。小时候他想象那是一条河流。后来他想象那是一道疤痕。现在他不知道它是什么了。
	
	他想起《了不起的盖茨比》的最后一句。那句话现在感觉不同了。
	
	*逆水行舟，被不断地向后推，直至回到往昔岁月。*
	
	也许这不是关于回到过去。也许这是关于过去从未真正过去。它一直在那里，在阁楼的旅行箱里，在母亲的每一瓶酒里，在奶奶偶尔望向门口的眼神里――仿佛期待着有人会回来。
	
	也许了解真相不会改变任何事。
	
	也许它只会给已经发生的事情一个名字。
	
	但伯克利需要那个名字。
	
	他在黑暗中闭上眼睛，听着农场的声音――风、田野、老房子在夜里的沉降。这些声音陪伴他度过了十八年。它们会继续陪伴他，无论他发现什么。
	
	他终于睡着了，梦见了海洋，那个他从未见过的湿的麦田，永远不停止移动。
	
	**[系统初始化中...]**
	
	**[加载中...]**
	
	**[故事开始]**)###";
	type_text(prolouge,1);
}
void init_first_time(){
	world_computers.emplace_back("Fitzgerald","root","123456");//0
	world_computers.emplace_back("Webserve","root","1q2w3e4r");//这里初始化世界数据到时候我预先存在一个配置文件里
}
void init_game_from_json(){
	string filename;
	cls();
	string tmp;
	cout<<"新游戏或者从存档导入？如果输入错误的存档将会强制退出，输入new以开始新游戏，输入load以加载存档:";
	getline(cin,tmp);
	if(tmp == "new"){
		init_first_time();
		show_the_background();
	} else if (tmp == "load"){
		cout<<"输入存档名（不需要后缀）:";
		getline(cin,filename);
		world_computers = load_world(filename + ".json");
	} else {
		cout<<"错误的指令，游戏退出"<<endl;
		exit(0);
	}
}
